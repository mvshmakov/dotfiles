#! /usr/bin/env sh

set -euo pipefail

RAMDISK_NAME="ramdisk"

# Extracted from https://apple.stackexchange.com/questions/58811/how-to-mount-a-ram-disk-on-startup
# APFS mount is extracted from https://stackoverflow.com/a/47354885/12349023
while [ ! -d /Volumes ]; do
    echo "Waiting..."
    sleep 2
done
if [ ! -d /Volumes/$RAMDISK_NAME ]; then
    echo "Creating ramdisk '$RAMDISK_NAME'..."
    # Mount 2 GB APFS ramdisk partition with RAMDISK_NAME
    diskutil partitionDisk $(hdiutil attach -nomount ram://$((2048 * 2048))) 1 GPTFormat APFS $RAMDISK_NAME '100%'
fi
